# create
aria2c "https://cloud-images.ubuntu.com/focal/current/focal-server-cloudimg-amd64.img"
sudo mv focal-server-cloudimg-amd64.img /var/lib/libvirt/images/
sudo qemu-img create -b /var/lib/libvirt/images/focal-server-cloudimg-amd64.img -f qcow2 -F qcow2 /var/lib/libvirt/images/ubuntu20.04.qcow2 50G
cloud-localds --verbose cloud-init.img user-data
sudo virt-install --name ubuntu20.04 \
  --virt-type kvm --memory 4096 --vcpus 2 \
  --boot hd,menu=on \
  --disk path=cloud-init.img,device=cdrom \
  --disk path=/var/lib/libvirt/images/ubuntu20.04.qcow2,device=disk \
  --graphics vnc \
  --os-type Linux --os-variant ubuntu20.04 \
  --network bridge=virbr0,model=virtio \
  --console pty,target_type=serial

# remove cdrom for cloud-init.img
sudo EDITOR=nvim virsh edit ubuntu20.04

# update
sudo apt update -y && sudo apt upgrade -y

# install docker
curl -fsSL https://get.docker.com | sudo sh -
sudo groupadd docker
sudo usermod -aG docker $USER

# kernel dev
sudo apt install -y git bc bison flex libssl-dev make vim neovim tmux

# clone vm
sudo virt-clone --original ubuntu20.04 --name 'netdev-ubuntu20.04' --auto-clone
# set hostname for new vm
hostnamectl set-hostname 'netdev-ubuntu20.04'
